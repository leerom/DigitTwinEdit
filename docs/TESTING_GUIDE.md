# ç³»ç»ŸéªŒè¯æµ‹è¯•æŒ‡å—

## å‰ææ¡ä»¶æ£€æŸ¥

åœ¨å¼€å§‹æµ‹è¯•ä¹‹å‰ï¼Œç¡®ä¿ä»¥ä¸‹æ¡ä»¶æ»¡è¶³ï¼š

### 1. PostgreSQL å®‰è£…å’Œè¿è¡Œ

```bash
# æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œ
pg_isready

# æˆ–è€…
psql --version
```

### 2. Node.js å’Œ pnpm

```bash
node --version  # åº”è¯¥ >= 18.x
pnpm --version  # åº”è¯¥ >= 8.x
```

### 3. ä¾èµ–å·²å®‰è£…

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
ls node_modules/.pnpm  # åº”è¯¥çœ‹åˆ°å¾ˆå¤šåŒ…
```

## ğŸ—„ï¸ æ­¥éª¤1: æ•°æ®åº“åˆå§‹åŒ–

### åˆ›å»ºæ•°æ®åº“

```bash
# æ–¹å¼1: ä½¿ç”¨ createdb
createdb digittwinedit

# æ–¹å¼2: ä½¿ç”¨ psql
psql -U postgres
CREATE DATABASE digittwinedit;
\q
```

### è¿è¡Œè¿ç§»è„šæœ¬

```bash
# ä»é¡¹ç›®æ ¹ç›®å½•
psql digittwinedit < packages/server/migrations/001_initial.sql

# æˆåŠŸååº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡º:
# CREATE TABLE
# CREATE TABLE
# CREATE TABLE
# CREATE TABLE
# CREATE INDEX
# ...
```

### éªŒè¯æ•°æ®åº“ç»“æ„

```bash
psql digittwinedit

# åœ¨ psql ä¸­æ‰§è¡Œ:
\dt          # æŸ¥çœ‹æ‰€æœ‰è¡¨
\d users     # æŸ¥çœ‹ users è¡¨ç»“æ„
\d projects  # æŸ¥çœ‹ projects è¡¨ç»“æ„
\d scenes    # æŸ¥çœ‹ scenes è¡¨ç»“æ„
\d session   # æŸ¥çœ‹ session è¡¨ç»“æ„
\q
```

**é¢„æœŸè¾“å‡º**:
- users (5ä¸ªå­—æ®µ)
- projects (7ä¸ªå­—æ®µ)
- scenes (7ä¸ªå­—æ®µ)
- session (3ä¸ªå­—æ®µ)

## âš™ï¸ æ­¥éª¤2: é…ç½®ç¯å¢ƒå˜é‡

### åç«¯é…ç½®

```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp packages/server/.env.example packages/server/.env
```

**ç¼–è¾‘ `packages/server/.env`**:

```env
# ä¿®æ”¹ä¸ºä½ çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯
DATABASE_URL=postgresql://ä½ çš„ç”¨æˆ·å:å¯†ç @localhost:5432/digittwinedit

# ç”Ÿæˆéšæœºå¯†é’¥ (å¿…éœ€!)
SESSION_SECRET=ä½ çš„éšæœº32ä½å¯†é’¥

# å…¶ä»–é…ç½®
PORT=3001
NODE_ENV=development
CORS_ORIGIN=http://localhost:5173
```

**ç”Ÿæˆ SESSION_SECRET**:
```bash
# æ–¹å¼1: ä½¿ç”¨ Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# æ–¹å¼2: ä½¿ç”¨ OpenSSL
openssl rand -hex 32

# å¤åˆ¶è¾“å‡ºçš„å­—ç¬¦ä¸²åˆ° .env æ–‡ä»¶
```

### å‰ç«¯é…ç½® (å·²å®Œæˆ)

æ–‡ä»¶ `packages/client/.env.development` å·²åˆ›å»º:
```env
VITE_API_URL=http://localhost:3001/api
```

## ğŸš€ æ­¥éª¤3: å¯åŠ¨æœåŠ¡

### å¯åŠ¨åç«¯

æ‰“å¼€**ç»ˆç«¯1**:

```bash
cd packages/server
pnpm dev
```

**é¢„æœŸè¾“å‡º**:
```
> @digittwinedit/server@1.0.0 dev
> tsx watch src/app.ts

âœ… Database connected
ğŸš€ Server running on port 3001
```

**å¦‚æœçœ‹åˆ°é”™è¯¯**:
- æ•°æ®åº“è¿æ¥å¤±è´¥ â†’ æ£€æŸ¥ DATABASE_URL
- ç«¯å£è¢«å ç”¨ â†’ æ›´æ”¹ PORT æˆ–å…³é—­å ç”¨çš„è¿›ç¨‹

### å¯åŠ¨å‰ç«¯

æ‰“å¼€**ç»ˆç«¯2**:

```bash
cd packages/client
pnpm dev
```

**é¢„æœŸè¾“å‡º**:
```
  VITE v7.x.x  ready in xxx ms

  âœ  Local:   http://localhost:5173/
  âœ  Network: use --host to expose
  âœ  press h + enter to show help
```

## âœ… æ­¥éª¤4: åŠŸèƒ½æµ‹è¯•

### æµ‹è¯•1: è®¿é—®ç™»å½•é¡µ

1. æ‰“å¼€æµè§ˆå™¨: **http://localhost:5173**
2. âœ… åº”è¯¥è‡ªåŠ¨è·³è½¬åˆ° `/login`
3. âœ… çœ‹åˆ°ç™»å½•é¡µé¢:
   - å·¦ä¾§: é¡¹ç›®åˆ—è¡¨åŒºåŸŸ (åˆå§‹ä¸ºç©º)
   - å³ä¾§: ç™»å½•è¡¨å•

### æµ‹è¯•2: æ³¨å†Œè´¦æˆ·

1. ç‚¹å‡»å³ä¸‹è§’ "Don't have an account? **Register**"
2. å¡«å†™æ³¨å†Œä¿¡æ¯:
   - Username: `testuser`
   - Email: `test@example.com` (å¯é€‰)
   - Password: `Test123!`
3. ç‚¹å‡» **Register**
4. âœ… çœ‹åˆ°æˆåŠŸæç¤ºï¼Œå¯¹è¯æ¡†å…³é—­

**éªŒè¯æ•°æ®åº“**:
```bash
psql digittwinedit -c "SELECT id, username, email FROM users;"
# åº”è¯¥çœ‹åˆ°æ–°æ³¨å†Œçš„ç”¨æˆ·
```

### æµ‹è¯•3: åˆ›å»ºé¡¹ç›®

1. åœ¨ç™»å½•é¡µï¼Œç‚¹å‡» "**Create Your First Project**"
2. (å¦‚æœæ²¡æœ‰è¿™ä¸ªæŒ‰é’®ï¼Œè¯´æ˜éœ€è¦å…ˆå®ç°åˆ›å»ºé¡¹ç›®å¯¹è¯æ¡†)
3. å¡«å†™é¡¹ç›®ä¿¡æ¯:
   - Name: `æˆ‘çš„ç¬¬ä¸€ä¸ªé¡¹ç›®`
   - Description: `æµ‹è¯•é¡¹ç›®`
4. ç‚¹å‡»åˆ›å»º
5. âœ… é¡¹ç›®å¡ç‰‡å‡ºç°åœ¨å·¦ä¾§

**å½“å‰çŠ¶æ€**: å¦‚æœæ²¡æœ‰åˆ›å»ºé¡¹ç›®çš„å¯¹è¯æ¡†ï¼Œå¯ä»¥é€šè¿‡ API æµ‹è¯•åˆ›å»ºï¼š

```bash
# å…ˆç™»å½•
curl -X POST http://localhost:3001/api/auth/login \
  -H "Content-Type: application/json" \
  -c cookies.txt \
  -d '{"username":"testuser","password":"Test123!"}'

# åˆ›å»ºé¡¹ç›®
curl -X POST http://localhost:3001/api/projects \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{"name":"æˆ‘çš„ç¬¬ä¸€ä¸ªé¡¹ç›®","description":"æµ‹è¯•é¡¹ç›®"}'

# åˆ·æ–°æµè§ˆå™¨ï¼Œåº”è¯¥çœ‹åˆ°é¡¹ç›®åˆ—è¡¨
```

### æµ‹è¯•4: ç™»å½•

1. ç‚¹å‡»é¡¹ç›®å¡ç‰‡ (åº”è¯¥é«˜äº®æ˜¾ç¤º)
2. åœ¨å³ä¾§è¡¨å•è¾“å…¥:
   - Username: `testuser`
   - Password: `Test123!`
3. å¯é€‰: å‹¾é€‰ "Remember me"
4. ç‚¹å‡» **Sign In**
5. âœ… è·³è½¬åˆ° `/editor/1` ç¼–è¾‘å™¨é¡µé¢

### æµ‹è¯•5: ç¼–è¾‘å™¨åŠŸèƒ½

1. âœ… ç¼–è¾‘å™¨ç•Œé¢åŠ è½½å®Œæˆ
2. âœ… Header å³ä¸Šè§’æ˜¾ç¤ºç”¨æˆ·å (`testuser`)
3. âœ… Header ä¸­é—´æ˜¾ç¤ºåœºæ™¯åˆ‡æ¢å™¨

**æ·»åŠ 3Då¯¹è±¡**:
1. ç‚¹å‡» Header çš„ "**æ·»åŠ **" èœå•
2. é€‰æ‹© "3Då¯¹è±¡" â†’ "ç«‹æ–¹ä½“ (Cube)"
3. âœ… åœºæ™¯ä¸­å‡ºç°ä¸€ä¸ª Cube
4. âœ… å·¦ä¾§å±‚çº§é¢æ¿æ˜¾ç¤º "Cube"

**æŸ¥çœ‹è‡ªåŠ¨ä¿å­˜**:
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾
3. ç§»åŠ¨æˆ–ä¿®æ”¹ Cube
4. âœ… 1ç§’åçœ‹åˆ°: `ğŸ”„ Auto-saving scene...`
5. âœ… ç„¶åçœ‹åˆ°: `âœ… Scene auto-saved successfully`

**éªŒè¯æŒä¹…åŒ–**:
1. åˆ·æ–°é¡µé¢ (F5)
2. âœ… Cube ä»ç„¶å­˜åœ¨
3. âœ… ä½ç½®ã€æ—‹è½¬ã€ç¼©æ”¾ä¿æŒä¸å˜

### æµ‹è¯•6: åœºæ™¯åˆ‡æ¢

1. ç‚¹å‡» Header ä¸­é—´çš„åœºæ™¯åç§°ä¸‹æ‹‰èœå•
2. ç‚¹å‡» "**New Scene**"
3. è¾“å…¥åœºæ™¯åç§°: `åœºæ™¯2`
4. ç‚¹å‡» Create
5. âœ… ç¼–è¾‘å™¨åˆ‡æ¢åˆ°æ–°åœºæ™¯ (ç©ºåœºæ™¯)
6. âœ… ä¸‹æ‹‰èœå•æ˜¾ç¤º2ä¸ªåœºæ™¯

**åˆ‡æ¢å›ç¬¬ä¸€ä¸ªåœºæ™¯**:
1. æ‰“å¼€åœºæ™¯åˆ‡æ¢å™¨
2. ç‚¹å‡» "é»˜è®¤åœºæ™¯" (æˆ–ç¬¬ä¸€ä¸ªåœºæ™¯)
3. âœ… åœºæ™¯åˆ‡æ¢æˆåŠŸ
4. âœ… ä¹‹å‰çš„ Cube é‡æ–°å‡ºç°

### æµ‹è¯•7: ç™»å‡º

1. ç‚¹å‡» Header å³ä¸Šè§’çš„ç”¨æˆ·å
2. ç‚¹å‡» "**Sign Out**"
3. âœ… è·³è½¬å›ç™»å½•é¡µé¢
4. âœ… é¡¹ç›®åˆ—è¡¨ä»æ˜¾ç¤º

### æµ‹è¯•8: è®°ä½å¯†ç 

1. å†æ¬¡ç™»å½•ï¼Œè¿™æ¬¡å‹¾é€‰ "**Remember me**"
2. å…³é—­æµè§ˆå™¨
3. é‡æ–°æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® http://localhost:5173
4. âœ… åº”è¯¥ä¿æŒç™»å½•çŠ¶æ€ (å¦‚æœé€‰æ‹©äº†é¡¹ç›®)

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: åç«¯å¯åŠ¨æ—¶æŠ¥é”™ `Connection refused`

**è§£å†³**:
```bash
# æ£€æŸ¥ PostgreSQL çŠ¶æ€
pg_ctl status

# å¯åŠ¨ PostgreSQL (å¦‚æœæœªè¿è¡Œ)
pg_ctl start

# æˆ–ä½¿ç”¨æœåŠ¡ç®¡ç†å™¨
sudo service postgresql start  # Linux
brew services start postgresql  # macOS
```

### é—®é¢˜2: è¡¨ä¸å­˜åœ¨

**ç—‡çŠ¶**: API è°ƒç”¨è¿”å› `relation "users" does not exist`

**è§£å†³**:
```bash
# é‡æ–°è¿è¡Œè¿ç§»
psql digittwinedit < packages/server/migrations/001_initial.sql
```

### é—®é¢˜3: Session ä¸ä¿å­˜

**ç—‡çŠ¶**: ç™»å½•ååˆ·æ–°é¡µé¢åˆé€€å‡ºäº†

**æ£€æŸ¥**:
1. `session` è¡¨æ˜¯å¦å­˜åœ¨: `psql digittwinedit -c "\d session"`
2. SESSION_SECRET æ˜¯å¦è®¾ç½®
3. æµè§ˆå™¨ Application æ ‡ç­¾æŸ¥çœ‹ Cookies

### é—®é¢˜4: CORS é”™è¯¯

**ç—‡çŠ¶**: æµè§ˆå™¨ Console æ˜¾ç¤º CORS policy é”™è¯¯

**è§£å†³**:
1. ç¡®ä¿åç«¯ `.env` ä¸­ `CORS_ORIGIN=http://localhost:5173`
2. ç¡®ä¿å‰ç«¯ `apiClient` è®¾ç½®äº† `withCredentials: true`
3. é‡å¯åç«¯æœåŠ¡

### é—®é¢˜5: æ¨¡å—æœªæ‰¾åˆ°

**ç—‡çŠ¶**: `Cannot find module '@digittwinedit/shared'`

**è§£å†³**:
```bash
# é‡æ–°æ„å»º shared åŒ…
cd packages/shared
pnpm build

# é‡æ–°å®‰è£…ä¾èµ–
cd ../..
pnpm install
```

## ğŸ“Š æµ‹è¯•è®°å½•è¡¨

ä½¿ç”¨æ­¤è¡¨æ ¼è®°å½•æµ‹è¯•ç»“æœ:

| æµ‹è¯•é¡¹ | çŠ¶æ€ | å¤‡æ³¨ |
|--------|------|------|
| æ•°æ®åº“åˆ›å»º | â¬œ | |
| è¿ç§»è„šæœ¬è¿è¡Œ | â¬œ | |
| åç«¯å¯åŠ¨ | â¬œ | |
| å‰ç«¯å¯åŠ¨ | â¬œ | |
| è®¿é—®ç™»å½•é¡µ | â¬œ | |
| æ³¨å†Œè´¦æˆ· | â¬œ | |
| åˆ›å»ºé¡¹ç›® | â¬œ | |
| ç”¨æˆ·ç™»å½• | â¬œ | |
| è¿›å…¥ç¼–è¾‘å™¨ | â¬œ | |
| æ·»åŠ 3Då¯¹è±¡ | â¬œ | |
| è‡ªåŠ¨ä¿å­˜ | â¬œ | |
| åˆ·æ–°æŒä¹…åŒ– | â¬œ | |
| åˆ›å»ºæ–°åœºæ™¯ | â¬œ | |
| åœºæ™¯åˆ‡æ¢ | â¬œ | |
| ç”¨æˆ·ç™»å‡º | â¬œ | |
| è®°ä½å¯†ç  | â¬œ | |

## ğŸ¯ ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡åï¼Œå¯ä»¥ï¼š

1. **æ·»åŠ åˆ›å»ºé¡¹ç›®å¯¹è¯æ¡†** (å¦‚æœç™»å½•é¡µæ²¡æœ‰)
2. **ç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•** (#17, #18)
3. **æ€§èƒ½ä¼˜åŒ–** - åœºæ™¯æ•°æ®å‹ç¼©
4. **å®‰å…¨åŠ å›º** - CSRF, é€Ÿç‡é™åˆ¶
5. **åŠŸèƒ½æ‰©å±•** - å‚è€ƒè®¡åˆ’æ–‡æ¡£çš„"åç»­æ‰©å±•æ–¹å‘"

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿ** å¼€å§‹æµ‹è¯•æ‚¨çš„å…¨æ–°åå°æœåŠ¡ç³»ç»Ÿå§ï¼ğŸš€
