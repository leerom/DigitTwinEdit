# 删除快捷键与递归删除前端交互测试方案

## 1. 测试概述
本方案旨在验证数字孪生三维场景编辑器中对象删除功能的前端交互逻辑。主要涵盖键盘快捷键响应、递归删除机制、撤销/重做系统集成以及用户界面反馈。

**依据文档**: `docs/plans/2026-01-24-delete-shortcut-design.md`
**测试类型**: 手动交互测试 + 单元测试建议

## 2. 测试环境
- **浏览器**: Chrome (最新版) / Edge (最新版)
- **操作系统**: Windows 10/11 (主要测试环境), macOS (验证快捷键兼容性)
- **前置条件**:
  - 编辑器已加载并处于编辑模式
  - Scene View 中至少包含一个父子层级结构的对象 (例如: Parent -> Child)
  - 侧边栏 Hierarchy 视图可见

## 3. 手动交互测试用例 (Functional Testing)

### 3.1 基础删除流程
| 用例ID | 测试场景 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-01** | 普通删除-确认 | 1. 在 Hierarchy 或 Scene View 中选中一个普通对象<br>2. 按下 `Delete` 键<br>3. 在弹出的确认对话框中点击"确认" | 1. 弹出删除确认对话框<br>2. 点击确认后，对象从场景中消失<br>3. 对象从 Hierarchy 列表中消失<br>4. 当前选中状态被清除 (Inspector 面板为空) | P0 |
| **TC-02** | 普通删除-取消 | 1. 选中一个对象<br>2. 按下 `Delete` 键<br>3. 在弹出的确认对话框中点击"取消"或点击遮罩层 | 1. 对话框关闭<br>2. 对象**未**被删除<br>3. 选中状态保持不变 | P1 |
| **TC-03** | 强制删除 | 1. 选中一个对象<br>2. 按下 `Shift + Delete` 键 | 1. **不**弹出确认对话框<br>2. 对象立即被删除<br>3. 选中状态被清除 | P0 |
| **TC-04** | 未选中删除 | 1. 点击空白处清除所有选中<br>2. 按下 `Delete` 或 `Shift + Delete` | 1. 无任何反应<br>2. 不报错 | P2 |

### 3.2 递归删除机制
| 用例ID | 测试场景 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-05** | 父子级联删除 | 1. 创建层级结构: Parent -> Child A, Child B<br>2. 仅选中 Parent 对象<br>3. 执行删除操作 (Delete + 确认 或 Shift+Delete) | 1. Parent 对象被删除<br>2. Child A 和 Child B 也一并被删除<br>3. Hierarchy 中整个分支消失 | P0 |
| **TC-06** | 仅删除子对象 | 1. 选中 Child A<br>2. 执行删除操作 | 1. 仅 Child A 被删除<br>2. Parent 和 Child B 保持不变 | P1 |

### 3.3 撤销与重做 (Undo/Redo)
| 用例ID | 测试场景 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-07** | 撤销删除 | 1. 删除一个带有子对象的父对象 (参考 TC-05)<br>2. 验证对象已消失<br>3. 按下 `Ctrl + Z` (Mac: Cmd + Z) | 1. Parent 及其所有子对象 (Child A, B) 恢复显示<br>2. Hierarchy 树结构完全恢复<br>3. (可选) 被恢复的对象重新变为选中状态 | P0 |
| **TC-08** | 重做删除 | 1. 执行完 TC-07 后<br>2. 按下 `Ctrl + Y` (或 Ctrl+Shift+Z) | 1. 对象再次被删除<br>2. 场景状态与删除后一致 | P1 |

### 3.4 多选操作
| 用例ID | 测试场景 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-09** | 多选删除 | 1. 按住 Ctrl 选中多个不相关的对象<br>2. 按下 `Delete` 键<br>3. 确认删除 | 1. 弹出一次确认对话框<br>2. 所有选中的对象均被删除 | P1 |

### 3.5 异常与回归测试
| 用例ID | 测试场景 | 操作步骤 | 预期结果 | 优先级 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-10** | 新增对象删除 (Bug Repro) | 1. 点击工具栏/菜单添加一个新的三维对象(如Cube)<br>2. 选中该对象<br>3. 按下 `Delete` 键并确认 | 1. 对象被正常删除<br>2. **界面保持正常显示，不出现黑屏**<br>3. 控制台无报错 | P0 |

## 4. 单元测试/集成测试建议 (Automated Testing)

建议在 `src/features/editor/commands/DeleteObjectsCommand.test.ts` 中实现以下测试逻辑：

### 4.1 DeleteObjectsCommand 测试
- **Execute**:
  - Mock 一个包含子对象的 SceneStore 数据。
  - 执行 Command，断言 Store 中的对象列表不包含目标ID及其子ID。
  - 断言 selection 数组为空。
- **Undo**:
  - 执行 Execute 后调用 Undo。
  - 断言 Store 中对象已恢复。
  - 断言父子关系 (`parentId` 字段) 正确恢复。
- **Redo**:
  - 执行 Undo 后调用 Redo。
  - 断言对象再次消失。

### 4.2 快捷键逻辑测试
- 模拟 `deleteObject` 快捷键触发，验证 `setDeleteConfirmation(true)` 被调用。
- 模拟 `deleteObjectImmediate` 快捷键触发，验证 `DeleteObjectsCommand` 被实例化并执行。

## 5. 验收标准
1. 所有 P0 级测试用例必须通过。
2. 递归删除逻辑无内存泄漏（删除后对象引用的彻底清理）。
3. 撤销操作能 100% 还原删除前的场景结构，包括位置、旋转、缩放属性。
4. 确认对话框样式符合 UI 规范，且遮挡底层操作。
